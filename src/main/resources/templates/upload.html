<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>이미지 업로드</title>
</head>
<body>
<h1>이미지 업로드</h1>

<input type="file" id="fileInput">
<button onclick="uploadFile()">업로드</button>

<div id="preview"></div>

<script>
    async function uploadFile() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) {
            alert("파일을 선택하세요");
            return;
        }

        // Presigned URL 요청
        const response = await fetch("/s3/presigned-url?filename=" + file.name, {method: "POST"});
        const data = await response.json();

        // S3 업로드
        const put = await fetch(data.url, {
            method: "PUT",
            headers: {"Content-Type": data.contentType},
            body: file
        });

        if (put.ok) {
            alert("업로드 성공!");

            // 업로드한 이미지 미리보기
            const imgUrl = data.url.split("?")[0]; // presigned URL에서 쿼리 제거
            document.getElementById("preview").innerHTML =
                `<img src="${imgUrl}" alt="업로드된 이미지" style="max-width:300px;">`;
        } else {
            alert("업로드 실패");
        }
    }
</script>
</body>
</html>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${title}">관리자 페이지</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
<div id="header"></div>

<main class="container py-4">
  <div class="content-box" style="width: 100%; min-height: 650px;">
    <h2 class="mb-4 text-center">관리자 페이지</h2>

    <!-- 부트스트랩 탭 -->
    <ul class="nav nav-tabs" id="adminTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button"
                role="tab" aria-controls="user" aria-selected="true">
          유저 목록
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="board-tab" data-bs-toggle="tab" data-bs-target="#board" type="button"
                role="tab" aria-controls="board" aria-selected="false">
          게시판 관리
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="image-upload-tab" data-bs-toggle="tab" data-bs-target="#image-upload" type="button"
                role="tab" aria-controls="image-upload" aria-selected="false">
          이미지 업로드
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="advertisement-tab" data-bs-toggle="tab" data-bs-target="#advertisement" type="button"
                role="tab" aria-controls="advertisement" aria-selected="false">
          광고 관리
        </button>
      </li>
    </ul>

    <div class="tab-content mt-3" id="adminTabContent">

      <!-- 유저 목록 탭 -->
      <div class="tab-pane fade show active" id="user" role="tabpanel" aria-labelledby="user-tab">
        <table class="table table-striped table-bordered text-center align-middle">
          <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Email</th>
            <th>닉네임</th>
            <th>가입일</th>
            <th>마지막 로그인</th>
            <th>권한</th>
          </tr>
          </thead>
          <tbody>
          <tr th:if="${users == null or #lists.isEmpty(users)}">
            <td colspan="6">데이터가 없습니다.</td>
          </tr>
          <tr th:each="user : ${users}">
            <td th:text="${user.userId}">1</td>
            <td th:text="${user.email}">test@email.com</td>
            <td th:text="${user.nickname}">닉네임</td>
            <td th:text="${#dates.format(user.firstDate, 'yyyy-MM-dd HH:mm')}">2025-09-09 11:11</td>
            <td th:text="${#dates.format(user.lastDate, 'yyyy-MM-dd HH:mm')}">2025-09-09 11:11</td>
            <td>
              <form th:action="@{'/admin/users/' + ${user.userId} + '/toggle'}" method="post">
                <button type="submit"
                        class="btn"
                        th:classappend="${user.userStatus} ? 'btn-success' : 'btn-secondary'"
                        th:text="${user.userStatus} ? '활성' : '비활성'"> 권한
                </button>
              </form>
            </td>
          </tr>
          </tbody>
        </table>

        <form th:action="@{/admin/users/search}" method="get" class="d-flex justify-content-center mt-3">
          <input type="text" name="keyword" class="form-control w-auto me-2" placeholder="닉네임을 입력하세요">
          <button type="submit" class="btn btn-primary">검색</button>
        </form>
      </div>

      <!-- 게시판 관리 탭 -->
      <div class="tab-pane fade" id="board" role="tabpanel" aria-labelledby="board-tab">
        <form th:action="@{/admin/board/notice}" method="post" class="mb-3">
          <input type="text" name="title" class="form-control mb-2" placeholder="공지 제목" required>
          <textarea name="content" class="form-control mb-2" rows="3" placeholder="공지 내용을 입력하세요" required></textarea>
          <button type="submit" class="btn btn-warning w-100">공지 등록</button>
        </form>

        <table class="table table-striped table-bordered text-center align-middle mt-3">
          <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>숨김 여부</th>
          </tr>
          </thead>
          <tbody>
          <tr th:if="${posts == null or #lists.isEmpty(posts)}">
            <td colspan="5">게시글이 없습니다.</td>
          </tr>
          <tr th:each="post : ${posts}">
            <td th:text="${post.id}">1</td>
            <td th:text="${post.title}">샘플 제목</td>
            <td th:text="${post.author}">작성자</td>
            <td th:text="${#dates.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-09-09 11:11</td>
            <td>
              <form th:action="@{'/admin/board/' + ${post.id} + '/toggle'}" method="post">
                <button type="submit"
                        class="btn"
                        th:classappend="${post.hidden} ? 'btn-secondary' : 'btn-success'"
                        th:text="${post.hidden} ? '숨김' : '공개'"> 숨김
                </button>
              </form>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- 이미지 업로드 탭 -->
      <div class="tab-pane fade" id="image-upload" role="tabpanel" aria-labelledby="image-upload-tab">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card shadow-sm">
              <div class="card-body p-4">
                <h1 class="card-title text-center mb-4">이미지 업로드</h1>
                <div class="mb-3">
                  <input type="file" id="fileInput" class="form-control" accept="image/*">
                </div>
                <button onclick="uploadFile()" class="btn btn-primary w-100">업로드</button>
                <div id="preview" class="mt-4 text-center"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 광고 관리 콘텐츠 -->
      <div class="tab-pane fade" id="advertisement" role="tabpanel" aria-labelledby="advertisement-tab">
        <div class="container mt-4">
          <h4 class="mb-4">광고 관리</h4>

          <div class="row">
            <!-- 왼쪽: 광고 업로드 -->
            <div class="col-md-5">
              <div class="card shadow-sm p-3 mb-4">
                <h5 class="mb-3">새 광고 등록</h5>
                <form id="uploadAdForm" enctype="multipart/form-data">
                  <div class="mb-3">
                    <label class="form-label">광고 이미지 선택</label>
                    <input type="file" class="form-control" name="imageFile" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">광고 제목</label>
                    <input type="text" class="form-control" name="title" placeholder="광고 제목 입력" required>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">업로드</button>
                </form>
              </div>
            </div>

            <!-- 오른쪽: 광고 순서 관리 -->
            <div class="col-md-7">
              <div class="card shadow-sm p-3">
                <h5 class="mb-3">광고 순서 변경 (드래그 앤 드롭)</h5>
                <ul id="sortable-ads" class="list-group mb-3">
                  <li th:each="ad : ${advertisements}"
                      class="list-group-item d-flex align-items-center"
                      th:attr="data-id=${ad.adventId}">
                    <img th:src="${ad.imagePath}" alt="광고 이미지"
                         style="width: 80px; height: auto; margin-right: 10px; border-radius: 4px;">
                    <span th:text="${ad.title}"></span>
                  </li>
                </ul>
                <button class="btn btn-success w-100" onclick="saveAdOrder()">순서 저장</button>
              </div>
            </div>
          </div>
        </div>
      </div>



    </div>
  </div>
</main>

<div id="footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/admin.js}"></script>

</body>
</html>
